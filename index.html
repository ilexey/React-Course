<!doctype html>
<html lang="en">
    <head>
		<meta charset="utf-8">
		<title>React Tutorial</title>
        <script src="react.development.js"></script>
        <script src="react-dom.development.js"></script>
        <script src="babel.min.js"></script>
        <script src="prop-types.js"></script>
        <style>
            .red {
                color: red
            }
            .none {
                display: none;
            }
            body {
                background: rgba(0, 102, 255, 0.38);
                font-family: sans-serif;
            }
            p {
                margin: 0 0 5px;
            }
            .article {
                background: #FFF;
                border: 1px solid rgba(0, 89, 181, 0.82);
                width: 600px;
                margin: 0 0 5px;
                box-shadow: 2px 2px 5px -1px rgb(0, 81, 202);
                padding: 3px 5px;
            }
            .newsAuthor {
                text-decoration: underline;
                color: #007DDC;
            }
            .newsCount {
                margin: 10px 0 0 0;
                display: block;
            }
            .testInput {
                margin: 0 5px 5px 0;
            }
            .add {
                margin: 0 5px 5px 0;
                width: 210px;
                border: 1px dashed rgba(0, 89, 181, 0.82);
                padding: 5px;
            }
            .addAuthor, .addText, .addBtn, .addCheckrule {
                display: block;
                margin: 0 0 5px 0;
                padding: 5px;
                width: 94%;
                border: 1px solid rgba(0, 89, 181, 0.82);
            }
            .addCheckrule {
                border: none;
                font-size: 12px;
            }
            .addBtn {
                box-sizing: content-box;
                color: #FFF;
                text-transform: uppercase;
                background: #007DDC;
            }
            .addBtn:disabled {
                background: #CCC;
                color: #999;
            }
        </style>
	</head>
	<body>
        <div id="root"></div>
        <script type="text/babel">
            const myNews = [
                {
                    id: 1,
                    author: 'Саша Печкин',
                    text: 'В четверг, четвёртого числа...',
                    bigText: 'в четыре с четвертью часа четыре чёрненьких чумазеньких чертёнка\
                    чертили чёрными чернилами чертёж.'
                },
                {
                    id: 2,
                    author: 'Просто Вася',
                    text: 'Считаю, что $ должен стоить 35 рублей!',
                    bigText: 'А евро 42!'
                },
                {
                    id: 3,
                    author: 'Max Frontend',
                    text: 'Прошло 2 года с прошлых учебников, а $ так и не стоит 35',
                    bigText: 'А евро опять выше 70.'
                },
                {
                    id: 4,
                    author: 'Гость',
                    text: 'Бесплатно. Без смс, про реакт, заходи - https://maxpfrontend.ru',
                    bigText: 'Еще есть группа VK, telegram и канал на youtube! Вся инфа на сайте,\
                    не реклама!'
                }
            ];

            class App extends React.Component {
                state = {
                    news: myNews,
                }
                handleAddNews = (data) => {
                    const nextNews = [data, ...this.state.news]
                    this.setState({news: nextNews})
                }
                render() {
                    return (
                        <React.Fragment>
                            <Add onAddNews={this.handleAddNews}/>
                            <h3>Новости</h3>
                            <News data={this.state.news}/>
                        </React.Fragment>
                    )
                }
            }

            class Add extends React.Component {
                state = {
                    name: "",
                    text: "",
                    bigText: "",
                    agree: false,
                }
                onBtnClickHandler = (e) => {
                    e.preventDefault()
                    const {name, text, bigText} = this.state
                    this.props.onAddNews({id: +new Date(), author: name, text,  bigText})
                }
                handleChange = (e) => {
                    const {id, value} = e.currentTarget
                    this.setState({[id]: e.currentTarget.value})
                }
                handleCheckboxChange = (e) => {
                    this.setState({agree: e.currentTarget.checked})
                }
                validate = () => {
                    const {name, text, bigText, agree} = this.state
                    if (name.trim() && text.trim() && bigText.trim() && agree) {
                        return true
                    }
                    return false
                }
                render() {
                    const {name, text, bigText, agree} = this.state
                    return (
                        <form className="add">
                            <input id="name" type="text" onChange={this.handleChange}
                            className="addAuthor" placeholder="Введите имя"
                            value={name}/>
                            <textarea id="text" onChange={this.handleChange} className="addText"
                            placeholder="Текст новости" value={text}></textarea>
                            <textarea id="bigText" onChange={this.handleChange} className="addText"
                            placeholder="Текст новости подробно" value={bigText}></textarea>
                            <label className="addCheckrule">
                                <input type="checkbox" onChange={this.handleCheckboxChange}/>
                                Я согласен с правилами
                            </label>
                            <button className="addBtn" onClick={this.onBtnClickHandler}
                            disabled={!this.validate()}>
                                Добавить новость
                            </button>
                        </form>
                    )
                }
            }

            class Article extends React.Component {
                state = {
                    visible: false
                }
                handleReadmoreClick = (e) => {
                    e.preventDefault()
                    this.setState({visible: true})
                }
                render() {
                    const {author, text, bigText} = this.props.data
                    const {visible} = this.state
                    return (
                        <div className="article">
                            <p className="newsAuthor">{author}:</p>
                            <p className="newsText">{text}</p>
                            {
                                !visible ? <a onClick={this.handleReadmoreClick}
                                href="#" className="newsReadmore">Подробнее</a> :
                                <p className="newsBigText">{bigText}</p>
                            }
                        </div>
                    )
                }
            }

            class News extends React.Component {
                renderNews = () => {
                    const {data} = this.props
                    let newsTemplate = null
                    if (data.length) {
                        newsTemplate = data.map(function(item) {
                            return (
                                <Article key={item.id} data={item}/>
                            )
                        })
                    } else {
                        newsTemplate = <p>К сожалению новостей нет</p>
                    }
                    return newsTemplate
                }
                render() {
                    const {data} = this.props
                    return (
                        <div className="news">
                            {this.renderNews()}
                            {
                                data.length ? <strong className={'newsCount'}>Всего новостей: {data.length}</strong> : null
                            }
                        </div>
                    )
                }
            }

            Add.propTypes = {
                onAddNews: PropTypes.func.isRequired,
            }

            News.propTypes = {
                data: PropTypes.array.isRequired
            }

            Article.propTypes = {
                data: PropTypes.shape({
                    id: PropTypes.number.isRequired,
                    author: PropTypes.string.isRequired,
                    text: PropTypes.string.isRequired,
                    bigText: PropTypes.string.isRequired
                })
            }

            ReactDOM.render(
                <App />,
                document.getElementById('root')
            )
            
        </script>
	</body>
</html>
